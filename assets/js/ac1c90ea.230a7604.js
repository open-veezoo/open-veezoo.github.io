"use strict";(self.webpackChunkveezoo_docs=self.webpackChunkveezoo_docs||[]).push([[7953],{3905:function(e,t,n){n.d(t,{Zo:function(){return l},kt:function(){return m}});var a=n(7294);function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function r(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function s(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?r(Object(n),!0).forEach((function(t){o(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function i(e,t){if(null==e)return{};var n,a,o=function(e,t){if(null==e)return{};var n,a,o={},r=Object.keys(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}var c=a.createContext({}),u=function(e){var t=a.useContext(c),n=t;return e&&(n="function"==typeof e?e(t):s(s({},t),e)),n},l=function(e){var t=u(e.components);return a.createElement(c.Provider,{value:t},e.children)},h="mdxType",d={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},p=a.forwardRef((function(e,t){var n=e.components,o=e.mdxType,r=e.originalType,c=e.parentName,l=i(e,["components","mdxType","originalType","parentName"]),h=u(n),p=o,m=h["".concat(c,".").concat(p)]||h[p]||d[p]||r;return n?a.createElement(m,s(s({ref:t},l),{},{components:n})):a.createElement(m,s({ref:t},l))}));function m(e,t){var n=arguments,o=t&&t.mdxType;if("string"==typeof e||o){var r=n.length,s=new Array(r);s[0]=p;var i={};for(var c in t)hasOwnProperty.call(t,c)&&(i[c]=t[c]);i.originalType=e,i[h]="string"==typeof e?e:o,s[1]=i;for(var u=2;u<r;u++)s[u]=n[u];return a.createElement.apply(null,s)}return a.createElement.apply(null,n)}p.displayName="MDXCreateElement"},1329:function(e,t,n){n.r(t),n.d(t,{assets:function(){return l},contentTitle:function(){return c},default:function(){return m},frontMatter:function(){return i},metadata:function(){return u},toc:function(){return h}});var a=n(7462),o=n(3366),r=(n(7294),n(3905)),s=["components"],i={id:"connect-to-amazon-athena",title:"Connecting to Amazon Athena",sidebar_label:"Connecting to Amazon Athena",slug:"/connect-to-amazon-athena"},c=void 0,u={unversionedId:"getting-started/database-connections/connect-to-amazon-athena",id:"getting-started/database-connections/connect-to-amazon-athena",title:"Connecting to Amazon Athena",description:"The following guide shows how to configure Veezoo to connect to Amazon Athena.",source:"@site/docs/getting-started/database-connections/connect-to-amazon-athena.md",sourceDirName:"getting-started/database-connections",slug:"/connect-to-amazon-athena",permalink:"/docs/connect-to-amazon-athena",draft:!1,tags:[],version:"current",frontMatter:{id:"connect-to-amazon-athena",title:"Connecting to Amazon Athena",sidebar_label:"Connecting to Amazon Athena",slug:"/connect-to-amazon-athena"},sidebar:"docs",previous:{title:"Connect a Dataset",permalink:"/docs/"},next:{title:"Connecting to BigQuery",permalink:"/docs/connect-to-bigquery"}},l={},h=[{value:"Creating IAM Credentials",id:"creating-iam-credentials",level:3},{value:"Finding the Query Output Location",id:"finding-the-query-output-location",level:3},{value:"Finding the Region",id:"finding-the-region",level:3},{value:"Finding the Workgroup and Data Source",id:"finding-the-workgroup-and-data-source",level:3}],d={toc:h},p="wrapper";function m(e){var t=e.components,i=(0,o.Z)(e,s);return(0,r.kt)(p,(0,a.Z)({},d,i,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("p",null,"The following guide shows how to configure Veezoo to connect to Amazon Athena."),(0,r.kt)("p",null,(0,r.kt)("img",{alt:"Database settings",src:n(8629).Z,width:"1232",height:"1522"})),(0,r.kt)("h3",{id:"creating-iam-credentials"},"Creating IAM Credentials"),(0,r.kt)("p",null,"Veezoo communicates with Amazon Athena with IAM credentials: an access key ID and a secret access key."),(0,r.kt)("p",null,"We recommend ",(0,r.kt)("a",{parentName:"p",href:"https://docs.aws.amazon.com/IAM/latest/UserGuide/id_users_create.html"},"creating a new IAM user")," specifically for Veezoo, with the minimum required permissions."),(0,r.kt)("p",null,"We recommend to use the permissions described below on the new IAM user. Adjust the resource names in the policy as needed for your environment, for example s3 bucket names, workgroup, glue catalog, database names and tables. In this example we use eu-central-1 as our region, 123456789 as our account number, athena_workgroup as our workgroup, and athena_db as our database. We give access to all tables in this database: ",(0,r.kt)("inlineCode",{parentName:"p"},'"arn:aws:glue:eu-central-1:123456789:table/athena_db/*"')," "),(0,r.kt)("p",null,"More details about a connection failure might appear in the Athena Recent Queries section, accessible from the ",(0,r.kt)("a",{parentName:"p",href:"https://console.aws.amazon.com/athena/home/query-editor"},"Amazon Athena query editor"),"."),(0,r.kt)("p",null,"To solve S3 authorization errors, for example, the following policy gives full access to the S3 bucket where query results are stored:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-json"},'{\n    "Version": "2012-10-17",\n    "Statement": [\n        {\n            "Sid": "AllowAthenaMetadata",\n            "Effect": "Allow",\n            "Action": [\n                "athena:GetTableMetadata",\n                "athena:ListEngineVersions",\n                "athena:ListDataCatalogs",\n                "athena:ListDatabases",\n                "athena:GetDatabase",\n                "athena:ListTableMetadata",\n                "athena:ListWorkGroups"\n            ],\n            "Resource": "*"\n        },\n        {\n            "Sid": "AllowAthenaDB",\n            "Effect": "Allow",\n            "Action": [\n                "athena:CreatePreparedStatement",\n                "athena:StartQueryExecution",\n                "athena:GetQueryResultsStream",\n                "athena:UpdatePreparedStatement",\n                "athena:GetQueryResults",\n                "athena:DeletePreparedStatement",\n                "athena:DeleteNamedQuery",\n                "athena:GetNamedQuery",\n                "athena:GetPreparedStatement",\n                "athena:ListQueryExecutions",\n                "athena:ListNamedQueries",\n                "athena:GetWorkGroup",\n                "athena:CreateNamedQuery",\n                "athena:StopQueryExecution",\n                "athena:GetQueryExecution",\n                "athena:BatchGetNamedQuery",\n                "athena:ListPreparedStatements",\n                "athena:BatchGetQueryExecution"\n            ],\n            "Resource": [\n                "arn:aws:athena:eu-central-1:123456789:workgroup/athena_workgroup",\n            ]\n        },\n        {\n            "Sid": "AllowGlue",\n            "Effect": "Allow",\n            "Action": [\n                "glue:GetTables",\n                "glue:GetDatabases",\n                "glue:GetTable",\n                "glue:GetDatabase"\n            ],\n            "Resource": [\n                "arn:aws:glue:eu-central-1::catalog",\n                "arn:aws:glue:eu-central-1:123456789:database/athena_db",\n                "arn:aws:glue:eu-central-1:123456789:table/athena_db/*"\n            ]\n        }\n    ]\n}\n')),(0,r.kt)("p",null,"The IAM user will also need access to the S3 buckets where the data lives and where the query output will be stored. This example uses ",(0,r.kt)("inlineCode",{parentName:"p"},"athena-query-output-bucket")," as our output bucket and the data bucket that our athena tables use is ",(0,r.kt)("inlineCode",{parentName:"p"},"athena-data-bucket"),". Adjust these as needed."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-json"},'{\n    "Version": "2012-10-17",\n    "Statement": [\n        {\n            "Sid": "AllowQueryOutput",\n            "Effect": "Allow",\n            "Action": [\n                "s3:Get*",\n                "s3:PutObject"\n            ],\n            "Resource": [\n                "arn:aws:s3:::athena-query-output-bucket",\n                "arn:aws:s3:::athena-query-output-bucket/*"\n            ]\n        },\n        {\n            "Sid": "AllowAccessToData",\n            "Effect": "Allow",\n            "Action": [\n                "s3:Get*",\n                "s3:List*"\n            ],\n            "Resource": [\n                "arn:aws:s3:::athena-data-bucket",\n                "arn:aws:s3:::athena-data-bucket/*"\n            ]\n        }\n    ]\n}\n')),(0,r.kt)("p",null,"Note that the S3 Bucket URL needs to appear both with and without the root path (with a wildcard), in the Resource section."),(0,r.kt)("p",null,"See ",(0,r.kt)("a",{parentName:"p",href:"https://docs.aws.amazon.com/IAM/latest/UserGuide/id_credentials_access-keys.html#Using_CreateAccessKey"},"this guide")," to learn more about creating access keys for an IAM user."),(0,r.kt)("h3",{id:"finding-the-query-output-location"},"Finding the Query Output Location"),(0,r.kt)("p",null,"Amazon Athena stores query results in a S3 Bucket. Create a new Bucket on the ",(0,r.kt)("a",{parentName:"p",href:"https://s3.console.aws.amazon.com/s3/home"},"Amazon S3 console"),", or choose an existing one if it is appropriate.\nThe query output location field also accepts Bucket URLs without a path, to save the result files in its root."),(0,r.kt)("p",null,"A query output location could have been set earlier in the settings of the ",(0,r.kt)("a",{parentName:"p",href:"https://console.aws.amazon.com/athena/home/query-editor"},"Amazon Athena Query Editor"),".\nIf so, using a different location for Veezoo only is also possible."),(0,r.kt)("p",null,"Read more about query output locations ",(0,r.kt)("a",{parentName:"p",href:"https://docs.aws.amazon.com/athena/latest/ug/querying.html"},"here"),"."),(0,r.kt)("p",null,(0,r.kt)("img",{alt:"Output location",src:n(9890).Z,width:"744",height:"488"})),(0,r.kt)("h3",{id:"finding-the-region"},"Finding the Region"),(0,r.kt)("p",null,"The current AWS region is displayed in the top right corner of the ",(0,r.kt)("a",{parentName:"p",href:"https://console.aws.amazon.com/athena/home"},"Amazon Athena console"),"."),(0,r.kt)("p",null,(0,r.kt)("img",{alt:"Region",src:n(4279).Z,width:"346",height:"308"})),(0,r.kt)("h3",{id:"finding-the-workgroup-and-data-source"},"Finding the Workgroup and Data Source"),(0,r.kt)("p",null,"From the ",(0,r.kt)("a",{parentName:"p",href:"https://console.aws.amazon.com/athena/home"},"Amazon Athena Query Editor"),", select the Workgroup and Data Source (also called ",(0,r.kt)("inlineCode",{parentName:"p"},"Data Catalog"),") you want to connect to."),(0,r.kt)("p",null,(0,r.kt)("img",{alt:"Workgroup and Catalog",src:n(1611).Z,width:"907",height:"482"})))}m.isMDXComponent=!0},1611:function(e,t,n){t.Z=n.p+"assets/images/athena-other-settings-6a8d16e93598c7b128ed615a38222dd8.png"},9890:function(e,t,n){t.Z=n.p+"assets/images/athena-query-result-0f61563800855011aab78bf3b555d928.png"},4279:function(e,t,n){t.Z=n.p+"assets/images/athena-region-03de7653c2d5910d2f60b40e8f68bb8b.png"},8629:function(e,t,n){t.Z=n.p+"assets/images/athena-veezoo-settings-db42913ee2358851d40dd26438fe1b7f.png"}}]);