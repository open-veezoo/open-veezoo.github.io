"use strict";(self.webpackChunkveezoo_docs=self.webpackChunkveezoo_docs||[]).push([[1568],{3905:function(e,n,t){t.d(n,{Zo:function(){return p},kt:function(){return f}});var a=t(7294);function i(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function l(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);n&&(a=a.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,a)}return t}function s(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?l(Object(t),!0).forEach((function(n){i(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):l(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function r(e,n){if(null==e)return{};var t,a,i=function(e,n){if(null==e)return{};var t,a,i={},l=Object.keys(e);for(a=0;a<l.length;a++)t=l[a],n.indexOf(t)>=0||(i[t]=e[t]);return i}(e,n);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);for(a=0;a<l.length;a++)t=l[a],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(i[t]=e[t])}return i}var o=a.createContext({}),d=function(e){var n=a.useContext(o),t=n;return e&&(t="function"==typeof e?e(n):s(s({},n),e)),t},p=function(e){var n=d(e.components);return a.createElement(o.Provider,{value:n},e.children)},m="mdxType",c={inlineCode:"code",wrapper:function(e){var n=e.children;return a.createElement(a.Fragment,{},n)}},u=a.forwardRef((function(e,n){var t=e.components,i=e.mdxType,l=e.originalType,o=e.parentName,p=r(e,["components","mdxType","originalType","parentName"]),m=d(t),u=i,f=m["".concat(o,".").concat(u)]||m[u]||c[u]||l;return t?a.createElement(f,s(s({ref:n},p),{},{components:t})):a.createElement(f,s({ref:n},p))}));function f(e,n){var t=arguments,i=n&&n.mdxType;if("string"==typeof e||i){var l=t.length,s=new Array(l);s[0]=u;var r={};for(var o in n)hasOwnProperty.call(n,o)&&(r[o]=n[o]);r.originalType=e,r[m]="string"==typeof e?e:i,s[1]=r;for(var d=2;d<l;d++)s[d]=t[d];return a.createElement.apply(null,s)}return a.createElement.apply(null,t)}u.displayName="MDXCreateElement"},5811:function(e,n,t){t.r(n),t.d(n,{assets:function(){return p},contentTitle:function(){return o},default:function(){return f},frontMatter:function(){return r},metadata:function(){return d},toc:function(){return m}});var a=t(7462),i=t(3366),l=(t(7294),t(3905)),s=["components"],r={id:"sql",title:"\u2699\ufe0f sql / name_sql / synonym_sql"},o=void 0,d={unversionedId:"reference/kb-layer/class/sql",id:"reference/kb-layer/class/sql",title:"\u2699\ufe0f sql / name_sql / synonym_sql",description:"Definition",source:"@site/docs/reference/kb-layer/class/sql.md",sourceDirName:"reference/kb-layer/class",slug:"/reference/kb-layer/class/sql",permalink:"/docs/reference/kb-layer/class/sql",draft:!1,tags:[],version:"current",frontMatter:{id:"sql",title:"\u2699\ufe0f sql / name_sql / synonym_sql"},sidebar:"reference",previous:{title:"class",permalink:"/docs/reference/kb-layer/class"},next:{title:"\u2699\ufe0f description_sql",permalink:"/docs/reference/kb-layer/class/description_sql"}},p={},m=[{value:"Definition",id:"definition",level:2},{value:"Usage",id:"usage",level:2},{value:"Class defined by Table",id:"class-defined-by-table",level:3},{value:"Class defined by Column",id:"class-defined-by-column",level:3},{value:"Advanced: Class defined by Table SQL",id:"advanced-class-defined-by-table-sql",level:3},{value:"Advanced: Class with Custom Entities defined by a SQL",id:"advanced-class-with-custom-entities-defined-by-a-sql",level:3},{value:"Custom Entities SQL for Hierarchies",id:"custom-entities-sql-for-hierarchies",level:4}],c={toc:m},u="wrapper";function f(e){var n=e.components,t=(0,i.Z)(e,s);return(0,l.kt)(u,(0,a.Z)({},c,t,{components:n,mdxType:"MDXLayout"}),(0,l.kt)("h2",{id:"definition"},"Definition"),(0,l.kt)("p",null,"The ",(0,l.kt)("inlineCode",{parentName:"p"},"sql")," property (and related ones) specifies how the class is represented in the database (as a table or a column), what a unique key (",(0,l.kt)("inlineCode",{parentName:"p"},"sql"),") for this class is and how its ",(0,l.kt)("a",{parentName:"p",href:"/docs/reference/kb-layer/entity"},"entities")," are generated from SQL, if it should have any."),(0,l.kt)("h2",{id:"usage"},"Usage"),(0,l.kt)("p",null,"A class can be defined by a table, a column or a SQL. Let's take the example of a table ",(0,l.kt)("inlineCode",{parentName:"p"},"customer(id, name, status)"),"."),(0,l.kt)("p",null,"In this example, Veezoo will generate two classes: ",(0,l.kt)("inlineCode",{parentName:"p"},"kb.Customer")," and ",(0,l.kt)("inlineCode",{parentName:"p"},"kb.Customer.Status"),"."),(0,l.kt)("h3",{id:"class-defined-by-table"},"Class defined by Table"),(0,l.kt)("p",null,"In the case of ",(0,l.kt)("inlineCode",{parentName:"p"},"kb.Customer"),", we have a class defined by a table ",(0,l.kt)("inlineCode",{parentName:"p"},"customer"),"."),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-json"},'import: [\n    db.postgres.movie_db.public.customer\n]\n\nkb {\n    class Customer {\n        name.en: "Customer"\n\n        from_table: customer\n        // e.g. 00042\n        sql: "${customer.id}"\n        // e.g. [00042] Arthur Dent\n        name_sql.en: "\'[\' || ${customer.id} || \'] \' || ${customer.name}"\n        // e.g. Arthur Dent\n        synonym_sql.en: "${customer.name}"\n\n        ...\n    }\n}\n')),(0,l.kt)("p",null,"Table Classes need to have"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"a reference to the table ",(0,l.kt)("inlineCode",{parentName:"li"},"from_table: customer")," and"),(0,l.kt)("li",{parentName:"ul"},"a SQL expression that uniquely identifies it ",(0,l.kt)("inlineCode",{parentName:"li"},'sql: "${customer.id}"'),", used for Joins as a key.")),(0,l.kt)("p",null,"Optionally, if it is a class with values that you may want to refer to in questions (e.g. a specific customer), it makes sense to define the name for the entities of this class."),(0,l.kt)("p",null,"To do this you will add a ",(0,l.kt)("inlineCode",{parentName:"p"},"name_sql")," with a language tag (e.g. ",(0,l.kt)("inlineCode",{parentName:"p"},".en")," for English), specifying how the ",(0,l.kt)("a",{parentName:"p",href:"/docs/reference/kb-layer/general/name"},"name")," of the entity will be generated. If no ",(0,l.kt)("inlineCode",{parentName:"p"},"name_sql")," is defined, Veezoo will use the ",(0,l.kt)("inlineCode",{parentName:"p"},"sql")," as the default ",(0,l.kt)("inlineCode",{parentName:"p"},"name_sql")," expression."),(0,l.kt)("p",null,"There may be ",(0,l.kt)("a",{parentName:"p",href:"/docs/reference/kb-layer/general/synonym"},"synonyms")," in the table that you also want to use for the entities. These you will define using the property ",(0,l.kt)("inlineCode",{parentName:"p"},"synonym_sql")," with the appropriate language tag.\nIn our example, after clicking on the ",(0,l.kt)("inlineCode",{parentName:"p"},"Sync Entities")," button in the Editor when you have the class file open, you will get entities like this:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-json"},'kb.Customer {\n    entity 00042_Arthur_Dent_1234 {\n        name.en: "[00042] Arthur Dent"\n\n        synonym.en: "Arthur Dent"\n\n        id: "00042"\n    }\n    ...\n}\n\n')),(0,l.kt)("p",null,"In the case of a class called ",(0,l.kt)("inlineCode",{parentName:"p"},"kb.Order"),", you may prefer not to have any entities defined. This means ",(0,l.kt)("inlineCode",{parentName:"p"},"name_sql")," and ",(0,l.kt)("inlineCode",{parentName:"p"},"synonym_sql")," will be left out."),(0,l.kt)("h3",{id:"class-defined-by-column"},"Class defined by Column"),(0,l.kt)("p",null,"In our example, the class ",(0,l.kt)("inlineCode",{parentName:"p"},"kb.Status")," was defined by the column ",(0,l.kt)("inlineCode",{parentName:"p"},"status")," in the ",(0,l.kt)("inlineCode",{parentName:"p"},"customer")," table. Let's take a look at how it would be defined in VKL."),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-json"},'import: [\n    db.postgres.movie_db.public.customer\n]\n\nkb {\n    // inside the file for the class Customer\n    class Customer {\n\n        ...\n\n\n        class Status {\n            name.en: "Status"\n\n            // e.g. ACTIVE\n            sql: "${customer.status}"\n        }\n    }\n}\n')),(0,l.kt)("p",null,"Each entity of the class ",(0,l.kt)("inlineCode",{parentName:"p"},"kb.Customer.Status")," is uniquely defined by the ",(0,l.kt)("inlineCode",{parentName:"p"},"sql")," expression, which also happens to be the default ",(0,l.kt)("inlineCode",{parentName:"p"},"name_sql")," for the entities.\nIn this case, there is no ",(0,l.kt)("inlineCode",{parentName:"p"},"synonym_sql")," defined."),(0,l.kt)("h3",{id:"advanced-class-defined-by-table-sql"},"Advanced: Class defined by Table SQL"),(0,l.kt)("p",null,"Let's assume that the ",(0,l.kt)("inlineCode",{parentName:"p"},"customer")," table is split across two tables ",(0,l.kt)("inlineCode",{parentName:"p"},"corporate_customer")," and ",(0,l.kt)("inlineCode",{parentName:"p"},"private_customer"),", both with the same set of columns for simplicity, and you want a single class consisting of both tables.\nYou can achieve this using ",(0,l.kt)("inlineCode",{parentName:"p"},"table_sql")," with a SQL query that returns their union, replacing ",(0,l.kt)("inlineCode",{parentName:"p"},"from_table")," as described for ",(0,l.kt)("a",{parentName:"p",href:"#class-defined-by-table"},"table classes"),"."),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-json"},'kb {\n    class Customer {\n        name.en: "Customer"\n\n        table_sql:\n             """(SELECT * FROM movie_db.public.corporate_customer)\n                 UNION\n                (SELECT * FROM movie_db.public.private_customer)"""\n        // These now use $table.column_name, where column_name is the SQL identifier\n        //  (which possibly needs to be escaped, depending on the SQL dialect)\n        sql: "$table.id"\n        name_sql.en: "\'[\' || $table.id || \'] \' || $table.name"\n        synonym_sql.en: "$table.name"\n\n        class Status {\n            name.en: "Status"\n\n            // Same for attributes of the class, use ${ClassName}.column_name\n            sql: "${Customer}.status"\n        }\n    }\n}\n')),(0,l.kt)("p",null,(0,l.kt)("inlineCode",{parentName:"p"},"table_sql")," also allows filtering, adding or transforming columns and joining other tables, and is thus very powerful."),(0,l.kt)("p",null,"Other than replacing ",(0,l.kt)("inlineCode",{parentName:"p"},"from_table")," by ",(0,l.kt)("inlineCode",{parentName:"p"},"table_sql")," and adapting SQLs based on it, a class defined using a table SQL will behave the same as a ",(0,l.kt)("a",{parentName:"p",href:"#class-defined-by-table"},"table class"),"."),(0,l.kt)("admonition",{type:"info"},(0,l.kt)("p",{parentName:"admonition"},"Prefer ",(0,l.kt)("a",{parentName:"p",href:"#class-defined-by-table"},"simple table classes")," over using ",(0,l.kt)("inlineCode",{parentName:"p"},"table_sql")," if possible, as Veezoo will be able to help you more, for example you can import columns from the table and Veezoo will generate VKL for them.")),(0,l.kt)("h3",{id:"advanced-class-with-custom-entities-defined-by-a-sql"},"Advanced: Class with Custom Entities defined by a SQL"),(0,l.kt)("p",null,"The last way you can define a class is over a SQL query defining the entities, which follows a specific format."),(0,l.kt)("p",null,"Let's take the example of two tables ",(0,l.kt)("inlineCode",{parentName:"p"},"customer(id, email)")," and ",(0,l.kt)("inlineCode",{parentName:"p"},"profile(id, customer_id, name)"),". For whatever reason, we have now two tables with information about a customer. For simplicity sake, let's assume that ",(0,l.kt)("inlineCode",{parentName:"p"},"profile")," only has one entry per customer."),(0,l.kt)("p",null,"Now, we don't want to make ",(0,l.kt)("inlineCode",{parentName:"p"},"profile")," accessible over Veezoo, since it is just extra information that was separated technically in different tables. Our business users have no clue why it is separated and they don't want to care about it."),(0,l.kt)("p",null,"What we will do instead now is to join both these tables so we can generate entities of the class ",(0,l.kt)("inlineCode",{parentName:"p"},"kb.Customer")," with nice-looking names."),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-json"},'import: [\n    db.postgres.movie_db.public.customer\n]\n\nkb {\n    class Customer {\n        name.en: "Customer"\n\n        // this tag is required\n        tag: DB_CustomSQLSemanticLink\n\n        // e.g. 00042\n        sql: "${customer.id}"\n        from_table: customer\n\n        entities_custom_sql: """\n            SELECT\n                c.id AS ID,\n                \'[\' || c.id || \'] \' || p.name AS LABEL_EN_MAIN,\n                p.name AS LABEL_EN_1,\n                p.profile_text AS DESCRIPTION_EN\n            FROM\n                customer c JOIN profile p ON c.id = p.customer_id\n        """\n    }\n}\n')),(0,l.kt)("p",null,"As you can notice, instead of a ",(0,l.kt)("inlineCode",{parentName:"p"},"name_sql")," and ",(0,l.kt)("inlineCode",{parentName:"p"},"description_sql"),", we defined an ",(0,l.kt)("inlineCode",{parentName:"p"},"entities_custom_sql"),"."),(0,l.kt)("p",null,"Let's take a closer look at the SQL:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-sql"},"SELECT\n    c.id AS ID,\n    '[' || c.id || '] ' || p.name AS LABEL_EN_MAIN,\n    p.name AS LABEL_EN_1\nFROM\n    customer c JOIN profile p ON c.id = p.customer_id\n")),(0,l.kt)("p",null,"An ",(0,l.kt)("inlineCode",{parentName:"p"},"entities_custom_sql")," always needs to have in the ",(0,l.kt)("inlineCode",{parentName:"p"},"SELECT"),":"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"One ",(0,l.kt)("inlineCode",{parentName:"li"},"ID")," column, coinciding with the ",(0,l.kt)("inlineCode",{parentName:"li"},"sql")," of the class"),(0,l.kt)("li",{parentName:"ul"},"At least one ",(0,l.kt)("inlineCode",{parentName:"li"},"LABEL_{LANGUAGE_TAG}_MAIN"),", which will define the ",(0,l.kt)("inlineCode",{parentName:"li"},"name")," of entities, similar to a ",(0,l.kt)("inlineCode",{parentName:"li"},"name_sql")," in the previous cases. Multiple can be provided for different languages.")),(0,l.kt)("p",null,(0,l.kt)("strong",{parentName:"p"},"Optional columns:")),(0,l.kt)("table",null,(0,l.kt)("thead",{parentName:"table"},(0,l.kt)("tr",{parentName:"thead"},(0,l.kt)("th",{parentName:"tr",align:null},"Column"),(0,l.kt)("th",{parentName:"tr",align:null},"Description"))),(0,l.kt)("tbody",{parentName:"table"},(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"LABEL_{LANGUAGE-TAG}_*")),(0,l.kt)("td",{parentName:"tr",align:null},"Additional labels used as synonyms, similar to ",(0,l.kt)("inlineCode",{parentName:"td"},"synonym_sql"),". The ",(0,l.kt)("inlineCode",{parentName:"td"},"*")," can be any suffix (e.g., ",(0,l.kt)("inlineCode",{parentName:"td"},"LABEL_EN_1"),", ",(0,l.kt)("inlineCode",{parentName:"td"},"LABEL_EN_CODE"),").")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"DESCRIPTION_{LANGUAGE-TAG}")),(0,l.kt)("td",{parentName:"tr",align:null},"Description for entities, similar to ",(0,l.kt)("inlineCode",{parentName:"td"},"description_sql"),".")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"FOR_USER_ROLE"),", ",(0,l.kt)("inlineCode",{parentName:"td"},"FOR_USER_ROLE_*")),(0,l.kt)("td",{parentName:"tr",align:null},"User roles for entity-level access control, similar to ",(0,l.kt)("a",{parentName:"td",href:"/docs/reference/kb-layer/class/for_user_role_sql"},(0,l.kt)("inlineCode",{parentName:"a"},"for_user_role_sql")),". If defined but all values are NULL/empty for an entity, that entity will not be created. Use ",(0,l.kt)("inlineCode",{parentName:"td"},"_ALLOW_ALL_")," to make an entity accessible to all users. The ",(0,l.kt)("inlineCode",{parentName:"td"},"*")," can be any suffix (e.g., ",(0,l.kt)("inlineCode",{parentName:"td"},"FOR_USER_ROLE_1"),").")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"PARENT")),(0,l.kt)("td",{parentName:"tr",align:null},"Parent entity ID for ",(0,l.kt)("a",{parentName:"td",href:"/docs/reference/kb-layer/class/hierarchy-class/"},"hierarchy classes"),".")))),(0,l.kt)("p",null,"It is important to notice that this SQL is only used to generate entities during sync time, not query time. If you are interested in using custom SQLs during query time, please refer to virtual_table in the ",(0,l.kt)("inlineCode",{parentName:"p"},"database")," part."),(0,l.kt)("h4",{id:"custom-entities-sql-for-hierarchies"},"Custom Entities SQL for Hierarchies"),(0,l.kt)("p",null,"The entities of a ",(0,l.kt)("a",{parentName:"p",href:"/docs/reference/kb-layer/class/hierarchy-class/"},"hierachy class")," can also be defined with ",(0,l.kt)("inlineCode",{parentName:"p"},"entities_custom_sql"),". For this the ",(0,l.kt)("inlineCode",{parentName:"p"},"entities_custom_sql")," need to define a ",(0,l.kt)("inlineCode",{parentName:"p"},"PARENT")," column, which contains the ID of the parent entity:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-js"},'import: [\n    db.public.region\n]\n\nkb {\n    class Region {\n        name.en: "Region"\n\n        tag: [\n            KB_HierarchyClass,\n            KB_NonAggregatedHierarchyClass\n        ]\n\n        entities_custom_sql: """\n            SELECT\n                r.id AS ID,\n                \'[\' || r.id || \'] \' || r.name AS LABEL_EN_MAIN,\n                r.name AS LABEL_EN_1,\n                r.parent_region AS PARENT\n            FROM\n                region r\n        """\n\n        ...\n    }\n}\n')))}f.isMDXComponent=!0}}]);