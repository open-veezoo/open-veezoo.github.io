"use strict";(self.webpackChunkveezoo_docs=self.webpackChunkveezoo_docs||[]).push([[9974],{3905:function(e,t,n){n.d(t,{Zo:function(){return c},kt:function(){return m}});var r=n(7294);function i(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function a(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function o(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?a(Object(n),!0).forEach((function(t){i(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):a(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,r,i=function(e,t){if(null==e)return{};var n,r,i={},a=Object.keys(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||(i[n]=e[n]);return i}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}var l=r.createContext({}),u=function(e){var t=r.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):o(o({},t),e)),n},c=function(e){var t=u(e.components);return r.createElement(l.Provider,{value:t},e.children)},p="mdxType",d={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},f=r.forwardRef((function(e,t){var n=e.components,i=e.mdxType,a=e.originalType,l=e.parentName,c=s(e,["components","mdxType","originalType","parentName"]),p=u(n),f=i,m=p["".concat(l,".").concat(f)]||p[f]||d[f]||a;return n?r.createElement(m,o(o({ref:t},c),{},{components:n})):r.createElement(m,o({ref:t},c))}));function m(e,t){var n=arguments,i=t&&t.mdxType;if("string"==typeof e||i){var a=n.length,o=new Array(a);o[0]=f;var s={};for(var l in t)hasOwnProperty.call(t,l)&&(s[l]=t[l]);s.originalType=e,s[p]="string"==typeof e?e:i,o[1]=s;for(var u=2;u<a;u++)o[u]=n[u];return r.createElement.apply(null,o)}return r.createElement.apply(null,n)}f.displayName="MDXCreateElement"},5973:function(e,t,n){n.r(t),n.d(t,{assets:function(){return c},contentTitle:function(){return l},default:function(){return m},frontMatter:function(){return s},metadata:function(){return u},toc:function(){return p}});var r=n(7462),i=n(3366),a=(n(7294),n(3905)),o=["components"],s={id:"default_filter",title:"default_filter"},l=void 0,u={unversionedId:"reference/kb-layer/class/default_filter",id:"reference/kb-layer/class/default_filter",title:"default_filter",description:"Definition",source:"@site/docs/reference/kb-layer/class/default_filter.md",sourceDirName:"reference/kb-layer/class",slug:"/reference/kb-layer/class/default_filter",permalink:"/docs/reference/kb-layer/class/default_filter",draft:!1,editUrl:"https://github.com/facebook/docusaurus/edit/master/website/docs/reference/kb-layer/class/default_filter.md",tags:[],version:"current",frontMatter:{id:"default_filter",title:"default_filter"},sidebar:"docs",previous:{title:"default_order",permalink:"/docs/reference/kb-layer/class/default_order"},next:{title:"display_with",permalink:"/docs/reference/kb-layer/class/display_with"}},c={},p=[{value:"Definition",id:"definition",level:2},{value:"Usage",id:"usage",level:2},{value:"Boolean Filter",id:"boolean-filter",level:3},{value:"Entity Filter",id:"entity-filter",level:3},{value:"Numeric filters",id:"numeric-filters",level:3},{value:"Filters across classes",id:"filters-across-classes",level:3},{value:"Refactoring",id:"refactoring",level:3}],d={toc:p},f="wrapper";function m(e){var t=e.components,n=(0,i.Z)(e,o);return(0,a.kt)(f,(0,r.Z)({},d,n,{components:t,mdxType:"MDXLayout"}),(0,a.kt)("h2",{id:"definition"},"Definition"),(0,a.kt)("p",null,"A ",(0,a.kt)("inlineCode",{parentName:"p"},"default_filter")," is a filter expression for a class that is applied by default if no conflicting filter was already explicitly asked for in a question."),(0,a.kt)("p",null,'With it you are able to model more accurately the language inside your company. An example is when we have subscriptions in the data, but it contains also cancelled ones. Yet, when people ask about subscriptions, they intuitively expect to see only "active" ones. With ',(0,a.kt)("inlineCode",{parentName:"p"},"default_filter"),', you don\'t need to pass the burden to the user of remembering to ask for "active", while not limiting their experience, if asking for "inactive" subscriptions is also a common use case.'),(0,a.kt)("p",null,"Whenever you set a ",(0,a.kt)("inlineCode",{parentName:"p"},"default_filter"),", the users will see it clearly in the answer with the possibility to remove it by clicking on it."),(0,a.kt)("h2",{id:"usage"},"Usage"),(0,a.kt)("h3",{id:"boolean-filter"},"Boolean Filter"),(0,a.kt)("p",null,"Let's take the example above. We have a class ",(0,a.kt)("inlineCode",{parentName:"p"},"kb.Subscription")," with a ",(0,a.kt)("inlineCode",{parentName:"p"},"boolean is_Active"),". This is how you would define it, using the VQL (Veezoo Query Language) syntax:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-js"},'kb {\n\n    class Subscription {\n\n        name.en: "Subscription"\n\n        ...\n\n\n        default_filter: """\n            this.is_Active = true\n        """\n\n        boolean is_Active { ... }\n\n    }\n\n}\n')),(0,a.kt)("p",null,"Notice the usage of ",(0,a.kt)("inlineCode",{parentName:"p"},"this"),", which refers to the ",(0,a.kt)("inlineCode",{parentName:"p"},"Subscription")," class."),(0,a.kt)("p",null,'What if you have two filters? Just write the condition in a new line and Veezoo will interpret it as "is active AND is valid".'),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-js"},'kb {\n\n    class Subscription {\n\n        name.en: "Subscription"\n\n        ...\n\n\n        default_filter: """\n            this.is_Active = true\n            this.is_Valid = true     # Every line is read as another AND\n        """\n\n        boolean is_Active { ... }\n\n        boolean is_Valid { ... }\n\n    }\n\n}\n')),(0,a.kt)("h3",{id:"entity-filter"},"Entity Filter"),(0,a.kt)("p",null,"Now, maybe there is no ",(0,a.kt)("inlineCode",{parentName:"p"},"is_Active")," flag, but rather a ",(0,a.kt)("inlineCode",{parentName:"p"},"Status")," which can be 'Active'."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-js"},'kb {\n\n    class Subscription {\n\n        name.en: "Subscription"\n\n        ...\n\n        default_filter: """\n            this.Status = kb.Subscription.Status.Active  # Tip: Let the Editor\'s Autocomplete help you find the right way to refer to the Status Active here\n        """\n\n        /** This is a class Status with entities like kb.Status.Active. */\n        class Status { ... }\n\n    }\n\n}\n')),(0,a.kt)("p",null,'In this case, if you would ask "how many subscriptions per status", Veezoo is smart enough to know not to apply the ',(0,a.kt)("inlineCode",{parentName:"p"},"default_filter"),"."),(0,a.kt)("p",null,"For negations, do it like this:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-js"},'default_filter: """\n    this.Status != kb.Subscription.Status.Cancelled\n"""\n')),(0,a.kt)("p",null,"Finally, maybe there are multiple statuses that you need to consider. For this case, we use a ",(0,a.kt)("inlineCode",{parentName:"p"},"union"),":"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-js"},'default_filter: """\n    this.Status = union(kb.Subscription.Status.Active, kb.Subscription.Status.On_Hold)\n"""\n')),(0,a.kt)("h3",{id:"numeric-filters"},"Numeric filters"),(0,a.kt)("p",null,"Let's say instead that we want to keep only those subscriptions by default with a positive subscription amount."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-js"},'default_filter: """\n    this.Amount > 0\n"""\n')),(0,a.kt)("p",null,"For numeric filters, we support: ",(0,a.kt)("inlineCode",{parentName:"p"},"<"),", ",(0,a.kt)("inlineCode",{parentName:"p"},"<="),", ",(0,a.kt)("inlineCode",{parentName:"p"},">")," and ",(0,a.kt)("inlineCode",{parentName:"p"},">="),". We also support numeric operators like ",(0,a.kt)("inlineCode",{parentName:"p"},"*"),", ",(0,a.kt)("inlineCode",{parentName:"p"},"+"),", ",(0,a.kt)("inlineCode",{parentName:"p"},"/")," and ",(0,a.kt)("inlineCode",{parentName:"p"},"-"),"."),(0,a.kt)("h3",{id:"filters-across-classes"},"Filters across classes"),(0,a.kt)("p",null,"What if we need to filter out subscriptions that have a inactive customer (according to a separate class and table)?"),(0,a.kt)("p",null,"This is how the default filter would change:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-js"},'kb {\n\n    class Subscription {\n        ...\n\n        relationship from_Customer { ... }\n        \n        default_filter: """\n            var c: kb.Customer     # think of this like the following SQL: FROM customers c\n\n            this.from_Customer = c\n            c.is_Active = true\n        """\n    }\n}\n')),(0,a.kt)("p",null,"This can be made shorter:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-js"},'default_filter: """\n    this.from_Customer.is_Active = true\n"""\n')),(0,a.kt)("p",null,"Now, let's go a bit wild. "),(0,a.kt)("p",null,"Let's say we have subscriptions and actual orders. And subscriptions should by default include only those with customers that had at least 2 orders at any point in time."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-js"},'default_filter: """\n    var c: kb.Customer\n\n    # c is this subscription\'s customer\n    this.from_Customer = c\n\n    var o: kb.Order         # these are orders from the same customer\n    o.from_Customer = c\n    \n    # let\'s count these orders here for each customer\n    var number_of_orders = count(o) by c\n    \n    # only those customers with at least 2 orders\n    number_of_orders >= 2\n"""\n')),(0,a.kt)("h3",{id:"refactoring"},"Refactoring"),(0,a.kt)("p",null,"Now this could get unnecessarily complicated and usually you will want to push certain definitions down to the data warehouse as part of your transformation layer (e.g. using dbt), especially if other applications or data consumers would benefit from it. This will allow you to have just a simple boolean flag and then we are back to the first example."),(0,a.kt)("p",null,"If for whatever reason you don't want to do so, you can also define a ",(0,a.kt)("inlineCode",{parentName:"p"},"boolean")," in Veezoo with the code from your more complicated ",(0,a.kt)("inlineCode",{parentName:"p"},"default_filter"),"."),(0,a.kt)("p",null,"Let's take it from the last example:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-js"},'kb {\n    class Subscription {\n\n        ...\n\n        default_filter: "this.is_Active = true"\n\n        boolean is_Active {\n            name.en: "Active"\n\n            description.en:\n                "A subscription is active if it is from a customer that made at least two orders."\n\n            definition: """\n                var c: kb.Customer\n\n                # c is this subscription\'s customer\n                this.from_Customer = c\n\n                var o: kb.Order         # these are orders from the same customer\n                o.from_Customer = c\n                \n                # let\'s count these orders here for each customer\n                var number_of_orders = count(o) by c\n                \n                # only those customers with at least 2 orders\n                number_of_orders >= 2\n            """\n        }\n    }\n}\n')),(0,a.kt)("p",null,"Or better, defining it in the ",(0,a.kt)("inlineCode",{parentName:"p"},"kb.Customer")," class."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-js"},'kb {\n\n    class Customer {\n\n        ...\n\n        default_filter: "this.is_Active = true"\n\n        boolean is_Active {\n            name.en: "Active"\n\n            description.en: "A customer that made at least two orders is deemed active."\n\n            definition: """\n                var o: kb.Order\n                o.from_Customer = this\n                            \n                var number_of_orders = count(o)\n                number_of_orders >= 2\n            """\n        }\n    }\n}\n')),(0,a.kt)("p",null,"Now, you can define the ",(0,a.kt)("inlineCode",{parentName:"p"},"default_filter")," for ",(0,a.kt)("inlineCode",{parentName:"p"},"Subscription")," as simply:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-js"},'kb {\n    class Subscription {\n            ...\n\n            relationship from_Customer { ... }\n            \n            default_filter: "this.from_Customer"\n    }   \n}   \n')),(0,a.kt)("p",null,"This may seem a bit less intuitive at first sight, but it means that the subscription has by default a customer set, which is itself by default active."),(0,a.kt)("p",null,"Ok, now that you know how to do all of this, remember the golden rule: Keep It Simple, Stupid."))}m.isMDXComponent=!0}}]);