<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-reference/kb-layer/rule/rule">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.3.1">
<title data-rh="true">rule | The Hitchhiker&#x27;s Guide to Veezoo</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://open-veezoo.github.io/docs/reference/kb-layer/rule/"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="rule | The Hitchhiker&#x27;s Guide to Veezoo"><meta data-rh="true" name="description" content="Definition"><meta data-rh="true" property="og:description" content="Definition"><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://open-veezoo.github.io/docs/reference/kb-layer/rule/"><link data-rh="true" rel="alternate" href="https://open-veezoo.github.io/docs/reference/kb-layer/rule/" hreflang="en"><link data-rh="true" rel="alternate" href="https://open-veezoo.github.io/docs/reference/kb-layer/rule/" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://1XLFHGRRDB-dsn.algolia.net" crossorigin="anonymous"><link rel="search" type="application/opensearchdescription+xml" title="The Hitchhiker&#39;s Guide to Veezoo" href="/opensearch.xml"><link rel="stylesheet" href="/assets/css/styles.761c0536.css">
<link rel="preload" href="/assets/js/runtime~main.5087c1c0.js" as="script">
<link rel="preload" href="/assets/js/main.3512a622.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo_full.png" alt="Veezoo Logo" class="themedImage_ToTc themedImage--light_HNdA"><img src="/img/logo_full_dark.png" alt="Veezoo Logo" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate"></b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/">Docs</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/reference/kb-layer/class">VKL Reference</a></div><div class="navbar__items navbar__items--right"><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebarViewport_Xe31"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" href="/docs/reference/kb-layer/class">Knowledge Base</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/reference/kb-layer/class">Class</a><button aria-label="Toggle the collapsible sidebar category &#x27;Class&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/reference/kb-layer/entity/">Entity</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/reference/kb-layer/relationship/">Relationship</a><button aria-label="Toggle the collapsible sidebar category &#x27;Relationship&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/reference/kb-layer/attribute/">Attributes</a><button aria-label="Toggle the collapsible sidebar category &#x27;Attributes&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/reference/kb-layer/measure/">Measure</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/reference/kb-layer/rule/">Rule</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/reference/kb-layer/function/">Function</a><button aria-label="Toggle the collapsible sidebar category &#x27;Function&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/docs/reference/kb-layer/general/name">General Properties</a></div></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/reference/db-layer/virtual-table">Database</a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/reference/discovery/">Discovery</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/reference/boards/">Boards</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/reference/ground-truths/">Ground Truths</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/reference/evolutions/">Evolutions</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/reference/ontology/person">Ontology</a></div></li></ul></nav></div></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Knowledge Base</span><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Rule</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>rule</h1></header><h2 class="anchor anchorWithStickyNavbar_LWe7" id="definition">Definition<a href="#definition" class="hash-link" aria-label="Direct link to Definition" title="Direct link to Definition">​</a></h2><p>In different cases we want to rewrite the VQL Veezoo generates from a user&#x27;s question. We might want to add filters, change which function Veezoo uses in specific situations, correct potential errors, or insert our own definitions of concepts. With <code>Measures</code> and <code>default filters</code> Veezoo provides frameworks to rewrite VQL in a simple and straightforward fashion. <code>rules</code> are a more general method. They detect patterns in the generated VQL and modify them in a desired fashion. </p><p>For almost all cases there is a way to achieve the desired result using other tools than rules, in which case we strongly recommend to use the alternative instead.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="structure">Structure<a href="#structure" class="hash-link" aria-label="Direct link to Structure" title="Direct link to Structure">​</a></h2><p>Rules follow this structure:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">rule only_show_active_customers {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    rule_pattern: &quot;&quot;&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        // Matching Pattern</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        var customer: kb.Customer</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        // Modification Pattern</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        @add_if_not_exists {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            customer.is_active = true</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    &quot;&quot;&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    // specify which user role should have this logic applied</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    for_user_role: &quot;Marketing&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    // specify the kind of rule</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    rule_tag: meta.SemanticLogicTag</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    comment: &quot;This is a description of the rule and its motivations.&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="rule_pattern">rule_pattern<a href="#rule_pattern" class="hash-link" aria-label="Direct link to rule_pattern" title="Direct link to rule_pattern">​</a></h3><p>The rule pattern consists of two parts: the <strong>Matching Pattern</strong> and the <strong>Modification Pattern</strong>. </p><p>The <strong>Matching Pattern</strong> can be a variety of VQL statements and serves two functions:</p><ul><li><em>Variable declaration</em>: <code>var customer: kb.Customers</code> declares the variable <code>customer</code>, which then can be referred to later on.</li><li><em>Rule condition</em>: Veezoo checks the <em>Matching Pattern</em> to see whether a rule should be applied. This rule comes into play only if everything listed in the <em>Matching Pattern</em> is also found in the VQL of the Question. </li></ul><p>Additionally we can use these functions to decide if the rule should be applied or not:</p><ul><li><em>@missing { ... }</em>: the rule should not be used, if the pattern in the brackets is present</li><li><em>{ ... } @or { ... }</em>: the rule should be applied when either pattern is present</li></ul><p>The <strong>Modification Pattern</strong> defines the actual behavior of the rule. It takes its arguments from within its brackets. The following are the available <em>Modification Patterns</em>:</p><ul><li><em>@add_if_not_exists { ... }</em>: adds a pattern to the VQL</li><li><em>@remove { ... }</em>: removes a pattern from the VQL, if present</li><li><em>@remove_connected { ... }</em>: similar to <em>@remove</em>, but also removes all classes connected to the pattern as well</li><li><em>@replace { ... } with { ... }</em>: replaces a specific pattern with another</li></ul><h4 class="anchor anchorWithStickyNavbar_LWe7" id="add_if_not_exists---">@add_if_not_exists { ... }<a href="#add_if_not_exists---" class="hash-link" aria-label="Direct link to @add_if_not_exists { ... }" title="Direct link to @add_if_not_exists { ... }">​</a></h4><p>This <em>Modification Pattern</em> is mostly used to add additional constraints or filters, the user didn&#x27;t explicitly ask for, but we, as the data team, still want to be there. Let&#x27;s look at the example given above again:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">rule only_show_active_customers {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    rule_pattern: &quot;&quot;&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        var customer: kb.Customer</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        @add_if_not_exists {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            customer.is_active = true</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    &quot;&quot;&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    for_user_role: &quot;Marketing&quot; </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>In this example, we want to ensure that users with the <code>user_role</code> <em>Marketing</em> can only see active customers.</p><ul><li>In the first line we define the variable <code>customer</code> and simultaneously state that this rule should be triggered if the pattern <code>kb.Customer</code> is present in the VQL.</li><li>We then use the <em>Modification Pattern</em>: if the filter <code>customer.is_active = true</code> is not present, we add it, such that all customers shown in the result are active.</li><li>We add the <code>for_user_role</code> such that this rule only applies to the marketing users (as explained later)</li></ul><p>A similar effect to this can be achieved by using <a href="/docs/reference/kb-layer/class/default_filter">default filters</a>. There are two differences: default filters can be removed by business users, where as this rule will always be applied, and default filters can&#x27;t be set for specific user roles.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="remove---">@remove { ... }<a href="#remove---" class="hash-link" aria-label="Direct link to @remove { ... }" title="Direct link to @remove { ... }">​</a></h4><p>With this <em>Modification Pattern</em> we can remove filters that Veezoo might add, but we don&#x27;t want in certain cases.</p><p>Consider the following scenario: we have two datasets, <em>Employees</em> containing information about employees, including their status (active or inactive), and <em>Transactions</em> containing records of sales transactions, each associated with an employee. We want to calculate the total sales amount without filtering out inactive employees, as we need to consider sales made by all employees, regardless of their current status.</p><p>To this end, we use the following rule:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">rule total_sales_all_employees {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    rule_pattern: </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    &quot;&quot;&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        var transactions: kb.Transactions</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        var employee: kb.Employee</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        sum(transactions.amount)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        transactions.with_Employee = employee</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        @remove {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">             # Remove the filter that only includes active employees</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            employee.is_Active = true</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        &quot;&quot;&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>In the <em>Matching Pattern</em> we first define the variables <code>transactions</code> and <code>employee</code> and ensure that the rule is only applied when calculating the sum total of transactions. We specify that transactions is linked with employee using <code>transactions.with_Employee = employee</code>.</p><p>Using the <em>@remove</em> pattern, we then explicitly remove the filter that restricts the data to only active employees (<code>employee.is_Active = true</code>).</p><p>By applying this rule, we ensure that the total sales are calculated without excluding any employees based on their status. This way, sales made by inactive employees are also considered in the total, providing a complete picture of sales performance.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="replace----with---">@replace { ... } with { ... }<a href="#replace----with---" class="hash-link" aria-label="Direct link to @replace { ... } with { ... }" title="Direct link to @replace { ... } with { ... }">​</a></h4><p>This <em>Modification Patterns</em> is used to replace lines in VQL. A typical example of this is, when Veezoo would normally use a certain function, but we want to use a different one in a specific case. In the following example, we will show two uses of this rule pattern working together. </p><p>Consider the following situation. We have an <code>Orders</code> dataset where each order has an <code>Order_Qty</code> column. The <code>Order_Qty</code> values are adjusted based on business logic, such as 1 for regular orders, 0 for orders that shouldn&#x27;t be counted, and -1 for orders that should decrease the count. This should be used when counting the orders instead of a <code>COUNT DISTINCT</code> on an order id.</p><p>This rule does this: it first checks if the question contains <code>kb.Orders</code>, and if so replaces all instances of the function <code>count(orders)</code> with <code>sum(orders.Order_Qty)</code>.</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">rule Substitute_Count_For_Sum {            </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    rule_pattern: </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">     &quot;&quot;&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        var orders: kb.Orders</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        @replace {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            count(orders)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        } with {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            sum(orders.Order_Qty)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        &quot;&quot;&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>In a next step, we would like to adapt the average function. Let&#x27;s say we would like to figure out the average value of an order last month. The default average function might just calculate the average <code>Value</code> of all <code>Orders</code>. This, again, would be false. We therefore replace the default <code>average(orders.Value)</code> with <code>sum(orders.Value) / count(orders)</code>:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">rule Adapt_Average {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    rule_pattern: </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">     &quot;&quot;&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        var orders: kb.Orders</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        @replace {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            average(orders.Value)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        } with {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            sum(orders.Value) / count(orders)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        &quot;&quot;&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Note that this rule uses <code>count(orders)</code>. So, when asking <em>Average value of an order last month?</em>  Veezoo would first replace <code>average(orders.Value)</code> with <code>sum(orders.Value) / count(orders)</code>, and then in a second step this with <code>sum(orders.Value) / sum(orders.Order_Qty)</code>. If we would only ever be interested in the average, we could of course only have one rule do both. </p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="for_user_role-optional">for_user_role (optional)<a href="#for_user_role-optional" class="hash-link" aria-label="Direct link to for_user_role (optional)" title="Direct link to for_user_role (optional)">​</a></h3><p>If there are user roles defined, you can use this tag to specify to whom the rule should apply. This can be useful, for example, if different roles have differing definitions of KPIs. For a more detailed explanation, see <a href="/docs/authorization/column-level-permission/#granting-column-level-permissions-with-for_user_role">here</a>.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="rule_tag-optional">rule_tag (optional)<a href="#rule_tag-optional" class="hash-link" aria-label="Direct link to rule_tag (optional)" title="Direct link to rule_tag (optional)">​</a></h3><p>This tag specifies when the rule is applied. There are two options:</p><ul><li>use <code>meta.SemanticLogicTag</code> if the rule should be applied in the <em>Semantic Rewriting</em> stage</li><li>use <code>meta.LogicRewritingTag</code> if the rule should be applied in the <em>Logic Rewriting</em> stage</li></ul><h4 class="anchor anchorWithStickyNavbar_LWe7" id="semantic-rewriting-stage">Semantic Rewriting stage<a href="#semantic-rewriting-stage" class="hash-link" aria-label="Direct link to Semantic Rewriting stage" title="Direct link to Semantic Rewriting stage">​</a></h4><p>This Rewriting stage is concerned with rewriting rules that need to be communicated to the user for clarity when answering.</p><p>Classical examples are default values, e.g. &quot;how many customers&quot; means &quot;how many active customers&quot; by default and the user should be made aware of that, in case that&#x27;s not what he/she wants.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="logic-rewriting-stage">Logic Rewriting stage<a href="#logic-rewriting-stage" class="hash-link" aria-label="Direct link to Logic Rewriting stage" title="Direct link to Logic Rewriting stage">​</a></h4><p>In contrast to Semantic Rewriting, rules in Logic Rewriting are rather technical and have no meaning for the end user.</p><p>A common case is when the database does not have the sought concept raw stored, but it should be computed from other concepts. We call these higher-order concepts.</p><p>These are usually KPI definitions (<code>measure</code>), e.g. to compute the profit we need to add <em>revenue x</em> with <em>revenue y</em> and subtract <em>costs z</em>, but not <em>costs w</em>.</p><p>The main difference for users will be if the rule affects the title of answers or not. If no <code>rule_tag</code> is specified, <code>meta.SemanticLogicTag</code> will be used by default.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="comment-optional">comment (optional)<a href="#comment-optional" class="hash-link" aria-label="Direct link to comment (optional)" title="Direct link to comment (optional)">​</a></h3><p>You can add descriptions to your rules to explain what it does. Comments have to use the <code>comment</code> tag to be saved. <code>// comments using slashes</code> will not cause any errors when compiling, but will be lost upon reloading the page.</p></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/reference/kb-layer/measure/"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">measure</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/reference/kb-layer/function/"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">What is a function?</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#definition" class="table-of-contents__link toc-highlight">Definition</a></li><li><a href="#structure" class="table-of-contents__link toc-highlight">Structure</a><ul><li><a href="#rule_pattern" class="table-of-contents__link toc-highlight">rule_pattern</a></li><li><a href="#for_user_role-optional" class="table-of-contents__link toc-highlight">for_user_role (optional)</a></li><li><a href="#rule_tag-optional" class="table-of-contents__link toc-highlight">rule_tag (optional)</a></li><li><a href="#comment-optional" class="table-of-contents__link toc-highlight">comment (optional)</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://stackoverflow.com/questions/tagged/veezoo" target="_blank" rel="noopener noreferrer" class="footer__link-item">Stack Overflow<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://twitter.com/veezoo" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://veezoo.com" target="_blank" rel="noopener noreferrer" class="footer__link-item">Website<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2024 Veezoo AG. Built with Docusaurus.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.5087c1c0.js"></script>
<script src="/assets/js/main.3512a622.js"></script>
</body>
</html>